<!DOCTYPE html><html lang="en">
  <head>
    <!-- Global Metadata --><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link type="text/plain" rel="author" href="/humans.txt">
<link rel="manifest" href="/manifest.json">

<!-- Primary Meta Tags -->
<title>SQL Snippets</title>
<meta name="title" content="SQL Snippets">
<meta name="description" content="Explore some pieces of T-SQL code that I've found useful.">

<!-- Icons -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- Theme -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Catamaran&display=swap" rel="stylesheet">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="theme-color" content="#de3f53">



    
  <link rel="stylesheet" href="/assets/asset.b433f4ea.css"></link>
</head>

  <body>
    <header class="blog-header">
      <nav class="astro-MASE5SZA"><a href="/" class="astro-MASE5SZA">Home</a><a href="/blog" class="astro-MASE5SZA">Blog</a></nav>



      <img class="blog-banner" src="/assets/blog-banner.jpg" alt="blog banner">
      <h1 class="blog-heading">SQL Snippets</h1>
      <span class="blog-category">Tutorials</span>
      <time class="blog-date">5 Apr 2019</time>
    </header>
    <article class="blog-content">
      <main>
        <p>In my early career I worked with a lot of databases, particularly SQL databases.
During this time I collected pieces of T-SQL code that I’ve found useful.
These have either been created by me or are based on a combination of code snippets
that I’ve put together from various sources to solve the problems I’ve encountered.</p><h2 id="table-existance">Table existance</h2><p>To check if a table exists, perhaps to avoid errors before dropping it, this
check is the way to go.</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">IF</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">object_id</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">&#39;tempdb.dbo.#Example&#39;</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">IS</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">NOT</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">NULL</span></span>
<span class="line"><span style="color: #C9D1D9">	</span><span style="color: #FF7B72">DROP</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">TABLE</span><span style="color: #C9D1D9"> #Example;</span></span></code></pre><h2 id="unusual-years">Unusual years</h2><p>Sometimes you don’t want to work with the standard year of January to December.
For example, you might be working with financial years (April to March) or academic
years (September to August).</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">SELECT</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">convert</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">VARCHAR</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">10</span><span style="color: #C9D1D9">), </span><span style="color: #FF7B72">CASE</span></span>
<span class="line"><span style="color: #C9D1D9">			</span><span style="color: #FF7B72">WHEN</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">datepart</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">month</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">getdate</span><span style="color: #C9D1D9">()) </span><span style="color: #FF7B72">&gt;=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">9</span></span>
<span class="line"><span style="color: #C9D1D9">				</span><span style="color: #FF7B72">THEN</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">convert</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">VARCHAR</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">10</span><span style="color: #C9D1D9">), </span><span style="color: #79C0FF">datepart</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">year</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">getdate</span><span style="color: #C9D1D9">())) </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;/&#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">right</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">convert</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">VARCHAR</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">10</span><span style="color: #C9D1D9">), </span><span style="color: #79C0FF">datepart</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">year</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">getdate</span><span style="color: #C9D1D9">()) </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">), </span><span style="color: #79C0FF">2</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">			</span><span style="color: #FF7B72">WHEN</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">datepart</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">month</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">getdate</span><span style="color: #C9D1D9">()) </span><span style="color: #FF7B72">&lt;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">9</span></span>
<span class="line"><span style="color: #C9D1D9">				</span><span style="color: #FF7B72">THEN</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">convert</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">VARCHAR</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">10</span><span style="color: #C9D1D9">), </span><span style="color: #79C0FF">datepart</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">year</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">getdate</span><span style="color: #C9D1D9">()) </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;/&#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">right</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">convert</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">VARCHAR</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">10</span><span style="color: #C9D1D9">), </span><span style="color: #79C0FF">datepart</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">year</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">getdate</span><span style="color: #C9D1D9">())), </span><span style="color: #79C0FF">2</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">			</span><span style="color: #FF7B72">END</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">AS</span><span style="color: #C9D1D9"> AcademicYear;</span></span></code></pre><h2 id="unix-timestamps">Unix timestamps</h2><p>If you find yourself working with Unix timestamps, perhaps after pulling in data
from a old LAMP stack style web app, then these calculations are particularly useful.</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">-- Converting from Unix timestamp to datetime</span></span>
<span class="line"><span style="color: #FF7B72">SELECT</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">dateadd</span><span style="color: #C9D1D9">(second, UnixTimeStamp, </span><span style="color: #A5D6FF">&#39;01-Jan-1970&#39;</span><span style="color: #C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8B949E">-- Converting datetime to Unix timestamp</span></span>
<span class="line"><span style="color: #FF7B72">SELECT</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">datediff</span><span style="color: #C9D1D9">(second, </span><span style="color: #A5D6FF">&#39;01-Jan-1970&#39;</span><span style="color: #C9D1D9">, UnixTimeStamp);</span></span></code></pre><h2 id="spacial-data">Spacial data</h2><p>If you have latitude and longitude and need to convert it to spacial data, then this
is a useful code snippet. I found this useful when mapping customer locations in
SQL service reporting services.</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">SELECT</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">convert</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">GEOGRAPHY</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">&#39;Point(&#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">convert</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">VARCHAR</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">20</span><span style="color: #C9D1D9">), Longitude) </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39; &#39;</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">convert</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">VARCHAR</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">20</span><span style="color: #C9D1D9">), Latitude) </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">&#39;)&#39;</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">AS</span><span style="color: #C9D1D9"> SpacialData;</span></span></code></pre><h2 id="sequence-row-groups">Sequence row groups</h2><p>To add a unique row number by a group, use the code snippet below. This can be useful
when de-duplicating rows that have an arbitrary difference and don’t naturally have
a min or max value.</p><pre class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">SELECT</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">row_number</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">OVER</span><span style="color: #C9D1D9"> (</span></span>
<span class="line"><span style="color: #C9D1D9">		</span><span style="color: #FF7B72">PARTITION</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">BY</span><span style="color: #C9D1D9"> something </span><span style="color: #FF7B72">ORDER BY</span><span style="color: #C9D1D9"> something</span></span>
<span class="line"><span style="color: #C9D1D9">		) </span><span style="color: #FF7B72">AS</span><span style="color: #C9D1D9"> SequenceID</span></span>
<span class="line"><span style="color: #C9D1D9">	,</span><span style="color: #FF7B72">*</span></span>
<span class="line"><span style="color: #FF7B72">FROM</span><span style="color: #C9D1D9"> Example;</span></span></code></pre><h2 id="git-repo">Git repo</h2><p>To view more useful pieces of T_SQL code, visit the <a href="https://github.com/zakwarren/UsefulSqlQueries">Github repo</a>.</p>
      </main>
    </article>
  </body></html>